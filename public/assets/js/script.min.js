$(document).ready((function(){$.getJSON("http://localhost:8000/flows.json",(function(t){let e=.475;let a='<table class="table table-condensed"><tr><th>Bezeichnung</th><th>Jahresarbeit<br/>(kwha)</th></tr>',n='<table class="table table-condensed"><tr><th>Bezeichnung</th><th>Jahresarbeit<br/>(kwha)</th></tr>',l='<table class="table table-condensed"><tr><th>Bezeichnung</th><th>Kapazität<br/>(kwh)</th></tr>';for(let e=0;e<t.length;e++)"PV-Generation"==t[e].type&&(n+="<tr><td>"+t[e].name+' (PV)</td><td align="right">'+t[e].multiplicator+"</td></tr>"),"Wind-Generation"==t[e].type&&(n+="<tr><td>"+t[e].name+' (Wind)</td><td align="right">'+t[e].multiplicator+"</td></tr>"),"Heating"==t[e].type&&(a+="<tr><td>"+t[e].name+' (Wärme)</td><td align="right">'+t[e].multiplicator+"</td></tr>"),"Consumption"==t[e].type&&(a+="<tr><td>"+t[e].name+' (Profil)</td><td align="right">'+t[e].multiplicator+"</td></tr>"),"ThermalStorage"==t[e].type&&(l+="<tr><td>"+t[e].name+' (thermisch)</td><td align="right">'+t[e].capacity+"</td></tr>"),"Battery"==t[e].type&&(l+="<tr><td>"+t[e].name+' (Batterie)</td><td align="right">'+t[e].capacity+"</td></tr>");a+="</table>",n+="</table>",l+="</table>",$(".html1_8_0").html(a),$(".html2_8_0").html(n),$(".htmlflex").html(l),$.getJSON("http://localhost:8000/api/profile",(function(t){let a=[],n=[],l=0,h=0,r=0,i=0,d=0,o=0,c=0,s=[];for(let e=0;e<t.length;e++)t[e][1]=t[e][1],s.push(""),t[e][1]>0&&(h+=Math.abs(t[e][1]),d++),t[e][1]<0&&(l+=Math.abs(t[e][1]),i++),r+=Math.abs(t[e][2]),c+=Math.abs(t[e][4]),o+=Math.abs(t[e][5]),a.push({date:t[e][0],kwh:t[e][1]}),n.push({date:t[e][0],kwh:t[e][2]});function m(t){let e="kWh",a=1e3;return t>5e8&&(e="MWh",a=1e6),t>5e11&&(e="GWh",a=1e9),Math.round(t/a).toFixed(0).replace(".",",").replace(/(\d)(?=(\d{3})+(?!\d))/g,"$1.")+" <span class='text-muted'>"+e+"</span>"}$(".inbalance").html(m(c-o)),$(".in1_8_0").html(m(o)),$(".in2_8_0").html(m(c));let p=Math.round((h-l)/1e3);$("#sum1_8_0").html(m(l)),$("#sum2_8_0").html(m(h)),$("#balance").html(m(h-l)),$(".co1_8_0").html(Math.round(l/1e3*e)),$(".co2_8_0").html(Math.round(h/1e3*e)),$(".cobalance").html(Math.round((o-l)/1e3*e)),p>0?$("#txtErgebnis").html("einen Überschuss"):$("#txtErgebnis").html("eine Unterdeckung"),$("#txtBalance").html(p),$(".txt1_8_0").html(Math.round(l/1e3)),$(".txt2_8_0").html(Math.round(h/1e3)),new Chart(document.getElementById("chartProfil"),{type:"line",data:{labels:a.map((t=>t.date)),datasets:[{label:"Jahresprofil",data:a.map((t=>t.kwh))}]},options:{scales:{x:{type:"time",time:{unit:"month",displayFormats:{month:"MMM"}}}},plugins:{legend:{display:!1}}}}),new Chart(document.getElementById("chartFlex"),{type:"line",data:{labels:a.map((t=>t.date)),datasets:[{label:"Flexibilität",data:n.map((t=>t.kwh))}]},options:{scales:{x:{type:"time",time:{unit:"month",displayFormats:{month:"MMM"}}}},plugins:{legend:{display:!1}}}}),a.sort(((t,e)=>t.kwh-e.kwh)),new Chart(document.getElementById("chartGang"),{type:"line",data:{labels:s,datasets:[{label:"Jahresdauerlinie",data:a.map((t=>t.kwh))}]},options:{plugins:{legend:{display:!1}}}});const u=function(t){const e=new Date(t);return e.getDay()+1+"."+e.getMonth()+". "+e.getHours()+":00"};$("#shaveLeft").html(u(a[1].date)+" "+Math.round(a[1].kwh)/1e3+" kWh"),$("#shaveRight").html(u(a[a.length-1].date)+" "+Math.round(a[a.length-1].kwh)/1e3+" kWh"),$("#cnt1_8_0").html(Math.round(i/a.length*100)),$("#cnt2_8_0").html(Math.round(d/a.length*100)),$("#cntbalance").html(Math.round((a.length-(i+d))/a.length*100)),0!==l&&$("#flex1_8_0").html(Math.round(r/l*100)),0!==h&&$("#flex2_8_0").html(Math.round(r/h*100)),$("#flex2_8_0").html(),$(".flexbalance").html(Math.round(r/1e3));let g=o-l,b=h,M=g+b;$("#gesamtErzAnIntern").html(Math.round(g/M*100)+"%"),$("#gesamtErzAnExtern").html(Math.round(b/M*100)+"%");let _=Math.abs(c-h),k=Math.abs(l),y=Math.abs(_)+Math.abs(k);$("#gesamtNutzVonIntern").html(Math.round(_/y*100)+"%"),$("#gesamtNutzVonExtern").html(Math.round(k/y*100)+"%"),$("#priceNutz").unbind(),$("#priceNutz").on("change",(function(){$("#priceErz").val($("#priceNutz").val()*(g/M)+$("#priceMarkt").val()*(b/M))})),$("#priceErz").unbind(),$("#priceErz").on("change",(function(){$("#priceNutz").val($("#priceErz").val()*(_/y)+$("#priceMarkt").val()*(k/y))})),$("#priceMarkt").unbind();const f=function(){$("#priceNutz").val(($("#priceErz").val()*(_/y)+$("#priceMarkt").val()*(k/y)).toFixed(2)),$("#priceErz").val(($("#priceNutz").val()*(g/M)+$("#priceMarkt").val()*(b/M)).toFixed(2))};$("#priceMarkt").on("change",f),$.getJSON("https://api.corrently.io/v2.0/gsi/marketdata?zip=69256",(function(t){$("#priceMarkt").val(t.data[0].marketprice),f()}))}))}))}));